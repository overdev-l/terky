"use strict";function n(n,t,e,r){return new(e||(e=Promise))((function(o,i){function a(n){try{u(r.next(n))}catch(n){i(n)}}function c(n){try{u(r.throw(n))}catch(n){i(n)}}function u(n){var t;n.done?o(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(a,c)}u((r=r.apply(n,t||[])).next())}))}function t(n,t){var e,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(u){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(e=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(n,a)}catch(n){c=[6,n],r=0}finally{e=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}}var e,r,o,i=(e=new Blob(["\nself.onmessage = function (e) {\n  const { url, init } = e.data\n  console.log(e)\n  const request = () => {\n  return fetch(url, init)\n  }\n  request().then(async res => {\n  const result = await res.text()\n  self.postMessage(result)\n  })\n}\n"],{type:"application/javascript"}),r=URL.createObjectURL(e),o=new Worker(r),function(n,t){return new Promise((function(e,r){o.onmessage=function(n){e(n.data)},o.onerror=function(n){console.log(n,"error"),r(n)},o.postMessage({url:n,init:t})}))});exports.useNotification=function(e){var r,o,a=this,c=new RegExp("".concat(e.key,"\\s*=\\s*['\"]([^'\"]+)['\"]")),u=!!(o=document.querySelector("body"))&&o.getAttribute("data-hash"),s=i.bind(null,e.url||"".concat(window.origin,"?t=").concat(Date.now()),e.init||{method:"get"}),l=function(){return n(a,void 0,void 0,(function(){var n,e;return t(this,(function(t){switch(t.label){case 0:return[4,s()];case 1:return n=t.sent(),[2,(e=n.match(c))&&e[1]||null]}}))}))},f=function(){return n(a,void 0,void 0,(function(){var n;return t(this,(function(t){switch(t.label){case 0:return"visible"!==document.visibilityState?[3,2]:[4,l()];case 1:return n=t.sent(),console.log(n,u,typeof n,typeof u,n!==u,"hash !== currentHash"),n!==u?d(!0):p(),[3,3];case 2:clearInterval(r),t.label=3;case 3:return[2]}}))}))},h=function(){return n(a,void 0,void 0,(function(){var n;return t(this,(function(t){switch(t.label){case 0:return[4,l()];case 1:return n=t.sent(),console.log(n,u,typeof n,typeof u,n!==u,"hash !== currentHash"),n!==u&&d(!0),[2]}}))}))},d=function(n){var t=function(n){return new CustomEvent("siteUpdate",{bubbles:!0,detail:{data:n}})}(n);window.dispatchEvent(t)},p=function(){r=setInterval((function(){return n(a,void 0,void 0,(function(){var n;return t(this,(function(t){switch(t.label){case 0:return[4,l()];case 1:return n=t.sent(),console.log(n,u,typeof n,typeof u,n!==u,"hash !== currentHash"),n!==u&&d(!0),[2]}}))}))}),e.delay)};u&&(window.addEventListener("load",h),document.addEventListener("visibilitychange",f),p())};
